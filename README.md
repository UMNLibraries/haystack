# Haystack

*Search a Large Zipped JSONL File with Regular Expressions and Save Results in Batches of JSON*

## Install

* `$ git clone https://github.com/UMNLibraries/haystack.git`
* `$ cd haystack;`
* `$ yarn install`
* `$ node run.js --help`

Download a zipped JSONL file (e.g. [DPLA bulk downloads](https://pro.dp.la/developers/bulk-download))

## Run

`node run.js -i 'EXAMPLE.dpla.json.gz' -r 'http://hub-client.lib.umn.edu/lookups/34.json' -d 'batches'


### regexURL Content Format:

* "include":  Include records that match any of the given RegEx patterns
  * "flags": RegEx [flags](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp)
  * "patterns": An array of regular expressions that are "ORed" together (with the pipe character "|").
* "exclude": A set of more complex patterns to filter out false positives generated by "include" patterns
  * "allMustMatch": batches of patterns can either require that all patterns match (boolean AND) or just one (boolean OR)

```JSON
  {
    "include": {
      "flags": "i",
      "patterns": [
        "Affirmative action"
      ]
    },
    "exclude": [
      {
        "allMustMatch": true,
        "patterns": [
          "Bears"
        ],
        "flags": "i"
      }
    ]
  }
```


